{"version":3,"sources":["extension.ts"],"names":[],"mappings":"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","file":"extension.js","sourcesContent":["/// <reference path=\"../typings/node.d.ts\" />\r\n'use strict';\r\nimport {commands,ExtensionContext,window} from 'vscode';\r\nimport * as fs from 'fs';\r\n// let extract = require('extract-zip');\r\nlet replace = require('replace-in-file');\r\nimport * as events from 'events';\r\nimport msg from './messages';\r\nimport * as settings from './settings';\r\nexport function deactivate(){\r\n    \r\n}\r\nexport function activate(context:ExtensionContext):void{\r\n    let eventEmitter = new events.EventEmitter();\r\n    let vars = settings.getSettings();\r\n    let installTurtle;\r\n    let uninstallTurtle;\r\n    let reinstallTurtle;\r\n    \r\n    console.log('vscode-turtle is active!');\r\n    function showAdminPrivilegesError() {\r\n        window.showInformationMessage(msg.admin);\r\n        let state = settings.getState();\r\n        if (state.status === settings.status.enabled) {\r\n            settings.deleteState();\r\n        }\r\n    }\r\n    //检查是否加载自己；\r\n    process.on('uncaughtException', function (err) {\r\n        if (/ENOENT|EACCES|EPERM/.test(err.code)) {\r\n            showAdminPrivilegesError();\r\n            return;\r\n        }\r\n    });\r\n    function reloadWindow() {\r\n        // reload vscode-window\r\n        commands.executeCommand('workbench.action.reloadWindow');\r\n    }\r\n    function disabledRestart() {\r\n        settings.setStatus(settings.status.disabled);\r\n        window.showInformationMessage(msg.disabled, { title: msg.restartIde })\r\n        .then(function () {\r\n            reloadWindow();\r\n        });\r\n    }\r\n    function installItem(bakfile:string, orfile:string, cleanInstallFunc:()=>void) {\r\n        fs.stat(bakfile, function (errBak, statsBak) {\r\n            if (errBak) {\r\n                // clean installation\r\n                cleanInstallFunc();\r\n            } else {\r\n                // check cssfilebak's timestamp and compare it to the cssfile's.\r\n                fs.stat(orfile, function (errOr, statsOr) {\r\n                    console.log(orfile);\r\n                    let updated = false;\r\n                    if (errOr) {\r\n                        window.showInformationMessage(msg.smthingwrong + errOr);\r\n                    } else {\r\n                        updated = hasBeenUpdated(statsBak, statsOr);\r\n                        if (updated) {\r\n                            // some update has occurred. clean install\r\n                            cleanInstallFunc();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n    function hasBeenUpdated(stats1, stats2):boolean {\r\n        let dbak = new Date(stats1.ctime);\r\n        let dor = new Date(stats2.ctime);\r\n        let segs = timeDiff(dbak, dor) / 1000;\r\n        return segs > 20;\r\n    }\r\n    function timeDiff(d1, d2):number {\r\n        let diff:number = Math.abs(d2.getTime() - d1.getTime());\r\n        return diff;\r\n    }\r\n    var fs = require( 'fs' ),\r\n    stat = fs.stat;\r\n\r\n    /*\r\n    * 复制目录中的所有文件包括子目录\r\n    * @param{ String } 需要复制的目录\r\n    * @param{ String } 复制到指定的目录\r\n    */\r\n    var copy = function( src, dst ){\r\n        // 读取目录中的所有文件/目录\r\n        fs.readdir( src, function( err, paths ){\r\n            if( err ){\r\n                throw err;\r\n            }\r\n\r\n            paths.forEach(function( path ){\r\n                var _src = src + '/' + path,\r\n                    _dst = dst + '/' + path,\r\n                    readable, writable;        \r\n\r\n                stat( _src, function( err, st ){\r\n                    if( err ){\r\n                        throw err;\r\n                    }\r\n\r\n                    // 判断是否为文件\r\n                    if( st.isFile() ){\r\n                        // 创建读取流\r\n                        readable = fs.createReadStream( _src );\r\n                        // 创建写入流\r\n                        writable = fs.createWriteStream( _dst );   \r\n                        // 通过管道来传输流\r\n                        readable.pipe( writable );\r\n                    }\r\n                    // 如果是目录则递归调用自身\r\n                    else if( st.isDirectory() ){\r\n                        exists( _src, _dst, copy );\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    // 在复制目录前需要判断该目录是否存在，不存在需要先创建目录\r\n    var exists = function( src, dst, callback ){\r\n        fs.exists( dst, function( exists ){\r\n            // 已存在\r\n            if( exists ){\r\n                callback( src, dst );\r\n            }\r\n            // 不存在\r\n            else{\r\n                fs.mkdir( dst, function(){\r\n                    callback( src, dst );\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n\r\n    function cleanJsInstall() {\r\n        let j = fs.createReadStream(vars.jsfile).pipe(fs.createWriteStream(vars.jsfilebak));\r\n        j.on('finish', function () {\r\n            replaceAllJs();\r\n            // // 复制目录\r\n            // exists( './src', './build', copy );\r\n        });\r\n    }\r\n    console.log(vars);\r\n\r\n    function replaceAllJs() {\r\n        replaceJs(/this\\.contentsContainer\\=this\\.createContents\\([a-z]\\.\\$\\(this\\.content\\)\\)/,        \r\n`/*turtle hook open begin*/\r\n            vsturtle.init(this,i,n,o,r,s,a,c,u,l,d,h,p,f,g,m,v,y,E,S,b,_,C,w,I,T,A,D,L,k,x,M,R,P,O,N,F,W,K,B,V,H,U,z,G,j,q,Y,$,X,Q,Z,J,ee,te,ie,ne,oe,re,se,ae,ce,ue,le,de)\r\n/*turtle hook open end*/`);\r\n        replaceJs(/^(.)/, \r\n`/*turtle hook global begin*/\r\nvsturtle = {\r\n    settingPath:'${vars.settingsPath.replace(/\\\\/g,'/')}',\r\n    setting:null,\r\n    workbenchShell:null,\r\n    nls:null,\r\n    platform:null,\r\n    builder_1:null,\r\n    dom:null,\r\n    aria:null,\r\n    lifecycle_1:null,\r\n    errors:null,\r\n    product_1:null,\r\n    package_1:null,\r\n    contextViewService_1:null,\r\n    timer:null,\r\n    workbench_1:null,\r\n    storage_1:null,\r\n    telemetry_1:null,\r\n    telemetryIpc_1:null,\r\n    telemetryService_1:null,\r\n    idleMonitor_1:null,\r\n    errorTelemetry_1:null,\r\n    workbenchCommonProperties_1:null,\r\n    integration_1:null,\r\n    update_1:null,\r\n    workspaceStats_1:null,\r\n    windowService_1:null,\r\n    messageService_1:null,\r\n    request_1:null,\r\n    requestService_1:null,\r\n    configuration_1:null,\r\n    fileService_1:null,\r\n    searchService_1:null,\r\n    lifecycleService_1:null,\r\n    threadService_1:null,\r\n    markerService_1:null,\r\n    modelService_1:null,\r\n    modelServiceImpl_1:null,\r\n    compatWorkerService_1:null,\r\n    compatWorkerServiceMain_1:null,\r\n    codeEditorServiceImpl_1:null,\r\n    codeEditorService_1:null,\r\n    editorWorkerServiceImpl_1:null,\r\n    editorWorkerService_1:null,\r\n    mainThreadExtensionService_1:null,\r\n    storage_2:null,\r\n    serviceCollection_1:null,\r\n    instantiationService_1:null,\r\n    contextView_1:null,\r\n    event_1:null,\r\n    files_1:null,\r\n    lifecycle_2:null,\r\n    markers_1:null,\r\n    environment_1:null,\r\n    message_1:null,\r\n    search_1:null,\r\n    threadService_2:null,\r\n    commands_1:null,\r\n    commandService_1:null,\r\n    workspace_1:null,\r\n    extensions_1:null,\r\n    modeServiceImpl_1:null,\r\n    modeService_1:null,\r\n    untitledEditorService_1:null,\r\n    crashReporter_1:null,\r\n    themeService_1:null,\r\n    themeService_2:null,\r\n    ipc_1:null,\r\n    ipc_net_1:null,\r\n    ipc_electron_1:null,\r\n    electron_1:null,\r\n    extensionManagementIpc_1:null,\r\n    extensionManagement_1:null,\r\n    urlIpc_1:null,\r\n    url_1:null,\r\n    registerPlugin:function(name,sourcePath){\r\n        \r\n    },\r\n    unRegisterPlugin:function(name){\r\n        \r\n    },\r\n    tableBarAction:{\r\n        DebugConsole:null,\r\n        OutPut:null,\r\n        Probrems:null,\r\n        IntegratedTerminal:null\r\n    },\r\n    __decorate:function (decorators, target, key, desc) {\r\n        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n        if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n        return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n    },\r\n    __param:function (paramIndex, decorator) {\r\n        return function (target, key) { decorator(target, key, paramIndex); }\r\n    },\r\n    init:function(workbenchShell,nls, platform, builder_1, dom, aria, lifecycle_1, errors, product_1, package_1, contextViewService_1, timer, workbench_1, storage_1, telemetry_1, telemetryIpc_1, telemetryService_1, idleMonitor_1, errorTelemetry_1, workbenchCommonProperties_1, integration_1, update_1, workspaceStats_1, windowService_1, messageService_1, request_1, requestService_1, configuration_1, fileService_1, searchService_1, lifecycleService_1, threadService_1, markerService_1, modelService_1, modelServiceImpl_1, compatWorkerService_1, compatWorkerServiceMain_1, codeEditorServiceImpl_1, codeEditorService_1, editorWorkerServiceImpl_1, editorWorkerService_1, mainThreadExtensionService_1, storage_2, serviceCollection_1, instantiationService_1, contextView_1, event_1, files_1, lifecycle_2, markers_1, environment_1, message_1, search_1, threadService_2, commands_1, commandService_1, workspace_1, extensions_1, modeServiceImpl_1, modeService_1, untitledEditorService_1, crashReporter_1, themeService_1, themeService_2, ipc_1, ipc_net_1, ipc_electron_1, electron_1, extensionManagementIpc_1, extensionManagement_1, urlIpc_1, url_1){\r\n        var _this=this;\r\n        this.workbenchShell=workbenchShell;\r\n        this.platform=platform;\r\n        this.builder_1=builder_1;\r\n        this.dom=dom;\r\n        this.aria=aria;\r\n        this.lifecycle_1=lifecycle_1;\r\n        this.errors=errors;\r\n        this.product_1=product_1;\r\n        this.package_1=package_1;\r\n        this.contextViewService_1=contextViewService_1;\r\n        this.timer=timer;\r\n        this.workbench_1=workbench_1;\r\n        this.storage_1=storage_1;\r\n        this.telemetry_1=telemetry_1;\r\n        this.telemetryIpc_1=telemetryIpc_1;\r\n        this.telemetryService_1=telemetryService_1;\r\n        this.idleMonitor_1=idleMonitor_1;\r\n        this.errorTelemetry_1=errorTelemetry_1;\r\n        this.workbenchCommonProperties_1=workbenchCommonProperties_1;\r\n        this.integration_1=integration_1;\r\n        this.update_1=update_1;\r\n        this.workspaceStats_1=workspaceStats_1;\r\n        this.windowService_1=windowService_1;\r\n        this.messageService_1=messageService_1;\r\n        this.request_1=request_1;\r\n        this.requestService_1=requestService_1;\r\n        this.configuration_1=configuration_1;\r\n        this.fileService_1=fileService_1;\r\n        this.searchService_1=searchService_1;\r\n        this.lifecycleService_1=lifecycleService_1;\r\n        this.threadService_1=threadService_1;\r\n        this.markerService_1=markerService_1;\r\n        this.modelService_1=modelService_1;\r\n        this.modelServiceImpl_1=modelServiceImpl_1;\r\n        this.compatWorkerService_1=compatWorkerService_1;\r\n        this.compatWorkerServiceMain_1=compatWorkerServiceMain_1;\r\n        this.codeEditorServiceImpl_1=codeEditorServiceImpl_1;\r\n        this.codeEditorService_1=codeEditorService_1;\r\n        this.editorWorkerServiceImpl_1=editorWorkerServiceImpl_1;\r\n        this.editorWorkerService_1=editorWorkerService_1;\r\n        this.mainThreadExtensionService_1=mainThreadExtensionService_1;\r\n        this.storage_2=storage_2;\r\n        this.serviceCollection_1=serviceCollection_1;\r\n        this.instantiationService_1=instantiationService_1;\r\n        this.contextView_1=contextView_1;\r\n        this.event_1=event_1;\r\n        this.files_1=files_1;\r\n        this.lifecycle_2=lifecycle_2;\r\n        this.markers_1=markers_1;\r\n        this.environment_1=environment_1;\r\n        this.message_1=message_1;\r\n        this.search_1=search_1;\r\n        this.threadService_2=threadService_2;\r\n        this.commands_1=commands_1;\r\n        this.commandService_1=commandService_1;\r\n        this.workspace_1=workspace_1;\r\n        this.extensions_1=extensions_1;\r\n        this.modeServiceImpl_1=modeServiceImpl_1;\r\n        this.modeService_1=modeService_1;\r\n        this.untitledEditorService_1=untitledEditorService_1;\r\n        this.crashReporter_1=crashReporter_1;\r\n        this.themeService_1=themeService_1;\r\n        this.themeService_2=themeService_2;\r\n        this.ipc_1=ipc_1;\r\n        this.ipc_net_1=ipc_net_1;\r\n        this.ipc_electron_1=ipc_electron_1;\r\n        this.electron_1=electron_1;\r\n        this.extensionManagementIpc_1=extensionManagementIpc_1;\r\n        this.extensionManagement_1=extensionManagement_1;\r\n        this.urlIpc_1=urlIpc_1;\r\n        this.url_1=url_1;\r\n        try{\r\n            var paths = fs.readFileSync(this.settingPath);\r\n            this.setting=JSON.parse(paths);\r\n        }catch(e){\r\n            console.log(e);\r\n        }\r\n        paths=this.setting.scriptPaths;\r\n        if(paths){\r\n            for(var i=0;i<paths.length;i++){\r\n                try{\r\n                    require(paths[i]).turtleActivate();\r\n                }catch(e){\r\n                    console.log(e);\r\n                }\r\n            }\r\n        }\r\n        //修改CompositePart 和 4个panel;\r\n        var CompositePart=require('vs/workbench/browser/parts/compositePart').CompositePart;\r\n        var IPartService=require('vs/workbench/services/part/common/partService').IPartService;\r\n        var IPanelService=require('vs/workbench/services/panel/common/panelService').IPanelService;\r\n        var ITerminalService=require('vs/workbench/parts/terminal/electron-browser/terminal').ITerminalService;\r\n        var Action=require('vs/base/common/actions').Action;\r\n        define('tablebar',['vs/nls!vs/workbench/workbench.turtle','vs/css!vs/workbench/media/tablebar'],function(nlsturtle){\r\n            vsturtle.nls=nlsturtle.tableBar;\r\n        });\r\n        var __decorate=this.__decorate;\r\n        var __param=this.__param;\r\n        var DebugConsole = (function (_super) {\r\n            __extends(DebugConsole, _super);\r\n            function DebugConsole(partService, panelService) {\r\n                _super.call(this, DebugConsole.ID, vsturtle.nls[0], 'switchDebug', true);\r\n                this.partService = partService;\r\n                this.panelService = panelService;\r\n                this.tooltip = vsturtle.nls[0];\r\n            }\r\n            DebugConsole.prototype.run = function () {\r\n                if (this.isReplVisible()) {\r\n                    this.partService.setPanelHidden(true);\r\n                    return winjs_base_1.TPromise.as(null);\r\n                }\r\n                return this.panelService.openPanel('workbench.panel.repl', true);\r\n            };\r\n            DebugConsole.prototype.isReplVisible = function () {\r\n                var panel = this.panelService.getActivePanel();\r\n                return panel && panel.getId() === 'workbench.panel.repl';\r\n            };\r\n            DebugConsole.ID = 'workbench.action.tablebar.switchDebug';\r\n            DebugConsole = __decorate([\r\n                __param(0, IPartService),\r\n                __param(1, IPanelService)\r\n            ], DebugConsole);\r\n            return DebugConsole;\r\n        }(Action));\r\n\r\n        var OutPut = (function (_super) {\r\n            __extends(OutPut, _super);\r\n            function OutPut(partService, panelService) {\r\n                _super.call(this, OutPut.ID, vsturtle.nls[1], 'switchOutput', true);\r\n                this.partService = partService;\r\n                this.panelService = panelService;\r\n                this.tooltip = vsturtle.nls[1];\r\n            }\r\n            OutPut.prototype.run = function () {\r\n                if (this.isReplVisible()) {\r\n                    this.partService.setPanelHidden(true);\r\n                    return winjs_base_1.TPromise.as(null);\r\n                }\r\n                return this.panelService.openPanel('workbench.panel.output', true);\r\n            };\r\n            OutPut.prototype.isReplVisible = function () {\r\n                var panel = this.panelService.getActivePanel();\r\n                return panel && panel.getId() === 'workbench.panel.output';\r\n            };\r\n            OutPut.ID = 'workbench.action.tablebar.switchOutPut';\r\n            OutPut = __decorate([\r\n                __param(0, IPartService),\r\n                __param(1, IPanelService)\r\n            ], OutPut);\r\n            return OutPut;\r\n        }(Action));\r\n\r\n        var Probrems = (function (_super) {\r\n            __extends(Probrems, _super);\r\n            function Probrems(partService, panelService) {\r\n                _super.call(this, Probrems.ID, vsturtle.nls[2], 'switchProbrems', true);\r\n                this.partService = partService;\r\n                this.panelService = panelService;\r\n                this.tooltip = vsturtle.nls[2];\r\n            }\r\n            Probrems.prototype.run = function () {\r\n                if (this.isReplVisible()) {\r\n                    this.partService.setPanelHidden(true);\r\n                    return winjs_base_1.TPromise.as(null);\r\n                }\r\n                return this.panelService.openPanel('workbench.panel.markers', true);\r\n            };\r\n            Probrems.prototype.isReplVisible = function () {\r\n                var panel = this.panelService.getActivePanel();\r\n                return panel && panel.getId() === 'workbench.panel.markers';\r\n            };\r\n            Probrems.ID = 'workbench.action.tablebar.Probrems';\r\n            Probrems = __decorate([\r\n                __param(0, IPartService),\r\n                __param(1, IPanelService)\r\n            ], Probrems);\r\n            return Probrems;\r\n        }(Action));\r\n\r\n        var IntegratedTerminal = (function (_super) {\r\n            __extends(IntegratedTerminal, _super);\r\n            function IntegratedTerminal(terminalService) {\r\n                _super.call(this, IntegratedTerminal.ID, vsturtle.nls[3], 'switchIntegratedTerminal', true);\r\n                this.terminalService = terminalService;\r\n                this.tooltip = vsturtle.nls[3];\r\n            }\r\n            IntegratedTerminal.prototype.run = function () {\r\n                return this.terminalService.toggle();\r\n            };\r\n            IntegratedTerminal.ID = 'workbench.action.tablebar.switchIntegratedTerminal';\r\n            IntegratedTerminal = __decorate([\r\n                __param(0, ITerminalService)\r\n            ], IntegratedTerminal);\r\n            return IntegratedTerminal;\r\n        }(Action));\r\n\r\n        this.tableBarAction.DebugConsole=DebugConsole;\r\n        this.tableBarAction.OutPut=OutPut;\r\n        this.tableBarAction.Probrems=Probrems;\r\n        this.tableBarAction.IntegratedTerminal=IntegratedTerminal;\r\n\r\n        function initTableBarActions(composite){\r\n            if(composite.hasTableActions){\r\n                return;\r\n            }\r\n            switch(composite.id){\r\n                case 'workbench.editors.stringEditor':\r\n                    require('vs/workbench/parts/output/browser/outputPanel').OutputPanel\r\n                    .prototype.getTableActions=function(){\r\n                        return _this.getTableActions(this,'OutputPanel');\r\n                    }\r\n                    composite.hasTableActions=true;\r\n                    break;\r\n                case 'workbench.panel.markers':\r\n                    require('vs/workbench/parts/markers/browser/markersPanel').MarkersPanel\r\n                    .prototype.getTableActions=function(){\r\n                        return _this.getTableActions(this,'MarkersPanel');\r\n                    }\r\n                    composite.hasTableActions=true;\r\n                    break;\r\n                case 'workbench.panel.terminal':\r\n                    require('vs/workbench/parts/terminal/electron-browser/terminalPanel').TerminalPanel\r\n                    .prototype.getTableActions=function(){\r\n                        return _this.getTableActions(this,'TerminalPanel');\r\n                    }\r\n                    composite.hasTableActions=true;\r\n                    break;\r\n                case 'workbench.panel.repl':\r\n                    require('vs/workbench/parts/debug/electron-browser/repl').Repl\r\n                    .prototype.getTableActions=function(){\r\n                        return _this.getTableActions(this,'Repl');\r\n                    }\r\n                    composite.hasTableActions=true;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        var hideActiveComposite=CompositePart.prototype.hideActiveComposite;\r\n        CompositePart.prototype.hideActiveComposite = function () {\r\n            var _this=this;\r\n            var ret=hideActiveComposite.call(this);\r\n            ret.then(function(){\r\n                _this.tableBar.clearChildren();\r\n            });\r\n            return ret;\r\n        };\r\n\r\n        var collectCompositeActions=CompositePart.prototype.collectCompositeActions;\r\n        CompositePart.prototype.collectCompositeActions = function (composite) {\r\n            var _this=this;\r\n            var ret=collectCompositeActions.call(this,composite);\r\n            initTableBarActions(composite);\r\n            if(composite.hasTableActions){\r\n                this.titleLabel.addClass('hidden');\r\n                var element=document.createElement('div');\r\n                var titleLabelBox=this.titleLabel.parent();\r\n                titleLabelBox.parent().getHTMLElement().insertBefore(element,titleLabelBox.getHTMLElement());\r\n                var div=new builder_1.Builder(element);\r\n                div.addClass('monaco-toolbar');\r\n                div.div({class:'monaco-action-bar animated'},(div)=>{\r\n                    _this.tableBar=div;\r\n                    div.div({},(div)=>{\r\n                        _this.tableBarBox=div;\r\n                    });\r\n                });\r\n                return function(){\r\n                    ret();\r\n                    var tableActions=composite.getTableActions();\r\n                    _this.tableBar.clearChildren();\r\n                    tableActions.forEach(function(element){\r\n                        _this.tableBarBox.div({class:'action-icon-item',role:\"presentation\"},function(div){\r\n                            if(element.enabled){\r\n                                div.on('click', function(event){\r\n                                    dom.EventHelper.stop(event, true);\r\n                                    element.run(event);\r\n                                });\r\n                            }else{\r\n                                div.style('border-bottom-style','solid');\r\n                            }\r\n                            div.a({\r\n                                class:'action-icon-label icon '+element.class,\r\n                                title:element.tooltip,\r\n                                innerHtml:element.label\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            }else{\r\n                return ret;\r\n            }\r\n        }\r\n        workbenchShell.contentsContainer = workbenchShell.createContents(builder_1.$(workbenchShell.content));\r\n    },\r\n    getTableActions:function(panel,panelName){\r\n        if (!panel.tableActions){\r\n            var output=panel.instantiationService.createInstance(this.tableBarAction.OutPut);\r\n            var probrems=panel.instantiationService.createInstance(this.tableBarAction.Probrems);\r\n            var debug=panel.instantiationService.createInstance(this.tableBarAction.DebugConsole);\r\n            var terminal=panel.instantiationService.createInstance(this.tableBarAction.IntegratedTerminal);\r\n            switch(panelName){\r\n                case 'Repl':\r\n                    debug.enabled=false;\r\n                    break;\r\n                case 'MarkersPanel':\r\n                    probrems.enabled=false;\r\n                    break;\r\n                case 'OutputPanel':\r\n                    output.enabled=false;\r\n                    break;\r\n                case 'TerminalPanel':\r\n                    terminal.enabled=false;\r\n                    break;\r\n            }\r\n            panel.tableActions = [\r\n                output,probrems,debug,terminal\r\n            ];\r\n        }\r\n        return panel.tableActions;\r\n    }\r\n};\r\n/*turtle hook global end*/\r\n$1`);\r\n    }\r\n    function replaceJs(jsreplace, jswith) {\r\n        let changed = null;\r\n        try {\r\n            changed = replace({\r\n                files: vars.jsfile,\r\n                replace: jsreplace,\r\n                with: jswith\r\n            });\r\n            console.log('REPLACE SUCCESSFUL:', jsreplace.toString());\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n        return changed;\r\n    }\r\n    function emitEndUninstall() {\r\n        eventEmitter.emit('endUninstall');\r\n    }\r\n    function restoredAction(isRestored:number, willReinstall:boolean) {\r\n        // if (isRestored === 2) {\r\n            if (willReinstall) {\r\n                emitEndUninstall();\r\n            } else {\r\n                disabledRestart();\r\n            }\r\n        // }\r\n    }\r\n\r\n    function restoreBak(willReinstall:boolean):void {\r\n        let restore = 0;\r\n        let j = null;\r\n        let c = null;\r\n\r\n        fs.unlink(vars.jsfile, function (err) {\r\n            if (err) {\r\n                showAdminPrivilegesError();\r\n                return;\r\n            }\r\n            j = fs.createReadStream(vars.jsfilebak)\r\n            .pipe(fs.createWriteStream(vars.jsfile));\r\n            j.on('finish', function () {\r\n                fs.unlink(vars.jsfilebak);\r\n                restore++;\r\n                restoredAction(restore, willReinstall);\r\n            });\r\n        });\r\n    }\r\n    function fInstall() {\r\n        installItem(vars.jsfilebak, vars.jsfile, cleanJsInstall);\r\n        // addTurtle();\r\n        settings.setStatus(settings.status.enabled);\r\n    }\r\n    \r\n    function fUninstall(willReinstall:boolean) {\r\n        fs.stat(vars.jsfilebak, function (errBak, statsBak) {\r\n            if (errBak) {\r\n                if (willReinstall) {\r\n                    emitEndUninstall();\r\n                } else {\r\n                    window.showInformationMessage(msg.already_disabled);\r\n                }\r\n                return;\r\n            }\r\n            // checking if normal file has been udpated.\r\n            fs.stat(vars.jsfile, function (errOr, statsOr) {\r\n                let updated = false;\r\n                if (errOr) {\r\n                    window.showInformationMessage(msg.smthingwrong + errOr);\r\n                } else {\r\n                    updated = hasBeenUpdated(statsBak, statsOr);\r\n                    if (updated) {\r\n                        // some update has occurred. clean install\r\n                        fs.unlink(vars.jsfilebak);\r\n                        if (willReinstall) {\r\n                            emitEndUninstall();\r\n                        } else {\r\n                            disabledRestart();\r\n                        }\r\n                    } else {\r\n                        // restoring bak files\r\n                        restoreBak(willReinstall);\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    function fReinstall() {\r\n        console.log('fReinstall');\r\n        eventEmitter.once('endUninstall', fInstall);\r\n        fUninstall(true);\r\n    }\r\n\r\n    installTurtle = commands.registerCommand('extension.installTurtle', fInstall);\r\n    uninstallTurtle = commands.registerCommand('extension.uninstallTurtle', fUninstall);\r\n    reinstallTurtle = commands.registerCommand('extension.reinstallTurtle', fReinstall);\r\n\r\n    context.subscriptions.push(installTurtle);\r\n    context.subscriptions.push(uninstallTurtle);\r\n    context.subscriptions.push(reinstallTurtle);\r\n\r\n    let state = settings.getState();\r\n    if (state.status === settings.status.notInstalled) {\r\n        fInstall();\r\n    } else  if (state.status === settings.status.enabled &&\r\n        state.version !== vars.extVersion) {\r\n        // auto-update\r\n        fReinstall();\r\n    }\r\n}"],"sourceRoot":"/source/"}